<!DOCTYPE html>

<html>
<head>
  <title>cleandocs_test.coffee.md</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>cleandocs_test.coffee.md</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <p>Some unit and integration tests for cleandocs</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>{fileUtil} = <span class="hljs-built_in">require</span> <span class="hljs-string">'../lib/fileUtil.js'</span>
cleandocs = <span class="hljs-built_in">require</span> <span class="hljs-string">'../lib/cleandocs.js'</span>
_ = <span class="hljs-built_in">require</span> <span class="hljs-string">'lodash'</span>

describe <span class="hljs-string">'cleandocs'</span>,<span class="hljs-function"> -&gt;</span>

  describe <span class="hljs-string">'processOptionsFile -&gt;'</span>,<span class="hljs-function"> -&gt;</span>
    optionsFile =
      <span class="hljs-attribute">docSuffix</span>: <span class="hljs-string">".md"</span>
      <span class="hljs-attribute">docTagStart</span>: <span class="hljs-string">'#*c:'</span>
      <span class="hljs-attribute">docTagEnd</span>: <span class="hljs-string">'*'</span>
      <span class="hljs-attribute">srcSuffix</span>: <span class="hljs-string">".coffee"</span>
      <span class="hljs-attribute">srcTagStart</span>: <span class="hljs-string">'#*c:'</span>
      <span class="hljs-attribute">srcTagEnd</span>: <span class="hljs-string">'*'</span>
      <span class="hljs-attribute">outputSuffix</span>: <span class="hljs-string">".litcoffee"</span>
      <span class="hljs-attribute">defaultTagOrder</span>: [<span class="hljs-string">'untagged'</span>, <span class="hljs-string">'description'</span>]
      <span class="hljs-attribute">dirs</span>: [
        {
          <span class="hljs-attribute">src</span>: <span class="hljs-string">"test-fixtures/fileUtil/app/scripts"</span>
          <span class="hljs-attribute">doc</span>: <span class="hljs-string">"test-fixtures/fileUtil/app/docs"</span>
          <span class="hljs-attribute">output</span>: <span class="hljs-string">'out/test-fixtures/mergeAndWriteFiles'</span>
        }
        {
          <span class="hljs-attribute">src</span>: <span class="hljs-string">"test-fixtures2/fileUtil/app/scripts"</span>
          <span class="hljs-attribute">doc</span>: <span class="hljs-string">"test-fixtures2/fileUtil/app/docs"</span>
          <span class="hljs-attribute">output</span>: <span class="hljs-string">'out/test-fixtures2/mergeAndWriteFiles'</span>
        }
      ]

    it <span class="hljs-string">'should produce an options object for each set of doc files'</span>,<span class="hljs-function"> -&gt;</span>
      allOptions = cleandocs.processOptionsFile optionsFile
      allOptions.length.should.eql <span class="hljs-number">2</span></pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Integration test that runs the function against the entire directory</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  describe <span class="hljs-string">'mergeAndWriteAllFiles -&gt;'</span>,<span class="hljs-function"> -&gt;</span>
    expectedDocFiles = [
      <span class="hljs-string">'README.litcoffee'</span>
      <span class="hljs-string">'subdir1/subdir2/subdirFile3.litcoffee'</span>
      <span class="hljs-string">'subdir1/subdirFile1.litcoffee'</span>
      <span class="hljs-string">'subdir1/subdirFile2.litcoffee'</span>
    ]

    pairedFiles =
      <span class="hljs-string">'README.md'</span>: {}
      <span class="hljs-string">'subdir1/subdir2/subdirFile3.md'</span>:
        <span class="hljs-attribute">srcFile</span>: <span class="hljs-string">'subdir1/subdir2/subdirFile3.coffee'</span>
      <span class="hljs-string">'subdir1/subdirFile1.md'</span>:
        <span class="hljs-attribute">srcFile</span>: <span class="hljs-string">'subdir1/subdirFile1.coffee'</span>
      <span class="hljs-string">'subdir1/subdirFile2.md'</span>: {}
    
    options =
      <span class="hljs-attribute">docSuffix</span>: <span class="hljs-string">".md"</span>
      <span class="hljs-attribute">docDir</span>: <span class="hljs-string">"test-fixtures/fileUtil/app/docs"</span>
      <span class="hljs-attribute">docTagStart</span>: <span class="hljs-string">'#*c:'</span>
      <span class="hljs-attribute">docTagEnd</span>: <span class="hljs-string">'*'</span>
      <span class="hljs-attribute">srcSuffix</span>: <span class="hljs-string">".coffee"</span>
      <span class="hljs-attribute">srcDir</span>: <span class="hljs-string">"test-fixtures/fileUtil/app/scripts"</span>
      <span class="hljs-attribute">srcTagStart</span>: <span class="hljs-string">'#*c:'</span>
      <span class="hljs-attribute">srcTagEnd</span>: <span class="hljs-string">'*'</span>
      <span class="hljs-attribute">outputSuffix</span>: <span class="hljs-string">".litcoffee"</span>
      <span class="hljs-attribute">outputDir</span>: <span class="hljs-string">'out/test-fixtures/writeFilesWithDocco'</span>
      <span class="hljs-attribute">defaultTagOrder</span>: [<span class="hljs-string">'untagged'</span>, <span class="hljs-string">'description'</span>]

    describe <span class="hljs-string">'without docco'</span>,<span class="hljs-function"> -&gt;</span>
      before<span class="hljs-function"> -&gt;</span>
        cleandocs.mergeAndWriteAllFiles pairedFiles, options
        
      it <span class="hljs-string">'should merge all of the comment files and write them to the output directory'</span>,<span class="hljs-function"> -&gt;</span>
        _.forEach expectedDocFiles, <span class="hljs-function"><span class="hljs-params">(nextExpectFile)</span> -&gt;</span>
          fileUtil.fileExists(options.outputDir, nextExpectFile).should.be.<span class="hljs-literal">true</span>

    describe <span class="hljs-string">'with docco'</span>,<span class="hljs-function"> -&gt;</span>
      options = _.extend _.clone(options),
        <span class="hljs-attribute">docco</span>: <span class="hljs-literal">true</span>

      before<span class="hljs-function"> -&gt;</span>
        cleandocs.mergeAndWriteAllFiles pairedFiles, options

      expectedDoccoFiles = [
        <span class="hljs-string">'README.html'</span>
        <span class="hljs-string">'subdir1/subdir2/subdirFile3.html'</span>
        <span class="hljs-string">'subdir1/subdirFile1.html'</span>
        <span class="hljs-string">'subdir1/subdirFile2.html'</span>
      ]

      it <span class="hljs-string">'should run each merged file through docco'</span>,<span class="hljs-function"> -&gt;</span>
        _.forEach expectedDoccoFiles, <span class="hljs-function"><span class="hljs-params">(nextExpectFile)</span> -&gt;</span>
          fileUtil.fileExists(options.outputDir, nextExpectFile).should.be.<span class="hljs-literal">true</span>

      it <span class="hljs-string">'should copy over the static css files and assets'</span>,<span class="hljs-function"> -&gt;</span>
        fileUtil.fileExists(options.outputDir, <span class="hljs-string">'docco.css'</span>).should.be.<span class="hljs-literal">true</span>
        fileUtil.dirExists(options.outputDir, <span class="hljs-string">'public'</span>).should.be.<span class="hljs-literal">true</span></pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
